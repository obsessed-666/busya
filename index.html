<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>–ü–æ–¥–∞—Ä–æ–∫ –¥–ª—è –ë—É—Å–∏</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Marck+Script&display=swap" rel="stylesheet">

<style>
  /* basic reset */
  *{box-sizing:border-box;margin:0;padding:0}
  :root{
    --vh:1vh;
    --safe-top:env(safe-area-inset-top,0px);
    --safe-right:env(safe-area-inset-right,0px);
    --safe-bottom:env(safe-area-inset-bottom,0px);
    --safe-left:env(safe-area-inset-left,0px);
    --panel-pad:clamp(14px,4vw,28px);
    --dark-volume:0.18;
    --love-volume:0.22;
  }
  html,body{height:100%;width:100%;background:#04070f;color:#fff;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}
  body{overflow:hidden;touch-action:manipulation;-webkit-tap-highlight-color:transparent}

  /* app container */
  #app{position:relative;width:100%;height:100%;overflow:hidden}

  /* background layers */
  .layer{position:absolute;inset:0;pointer-events:none}
  #forestBg{background:#0b0f1a url('forest.jpg') center/cover no-repeat;filter:brightness(.86) contrast(1.02);transition:filter .9s,opacity .9s}
  #forestOverlay{background:linear-gradient(180deg,rgba(2,5,10,.8),rgba(0,0,0,.6));}
  #romanceVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity 1.2s ease}
  .mistLayer{position:absolute;inset:0;filter:blur(22px);opacity:.45;background:
    radial-gradient(circle at 18% 16%, rgba(120,150,200,.12), transparent 40%),
    radial-gradient(circle at 80% 76%, rgba(80,120,170,.08), transparent 45%);
    transform:translateZ(0);pointer-events:none}

  /* intro (cat) */
  #intro{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:var(--panel-pad)}
  #introCard{width:min(88vw,520px);background:linear-gradient(180deg,#0f0c10,#060507);border-radius:18px;padding:14px;border:3px solid rgba(255,255,255,.04);box-shadow:0 30px 90px rgba(0,0,0,.6);text-align:center;cursor:pointer}
  #introCard img{width:100%;height:auto;border-radius:12px;display:block;user-select:none;pointer-events:none;animation:catPulse 3.6s ease-in-out infinite}
  #introHint{margin-top:10px;font-size:14px;color:rgba(255,255,255,.86)}
  @keyframes catPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.014)}}

  /* scene containers */
  .scene{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:var(--panel-pad);opacity:0;pointer-events:none;transition:opacity .45s ease}
  .scene.active{opacity:1;pointer-events:auto}

  /* story card */
  #storyCard{width:min(92vw,900px);max-height:calc(100dvh - 2*var(--panel-pad) - var(--safe-top) - var(--safe-bottom));background:linear-gradient(180deg, rgba(6,7,10,.86), rgba(8,9,12,.7));border-radius:18px;border:1px solid rgba(255,255,255,.04);box-shadow:0 24px 80px rgba(0,0,0,.65);overflow:hidden;position:relative;padding:0}
  #storyInner{padding:22px 20px 30px;max-height:calc(100dvh - 180px);overflow:auto;scroll-behavior:smooth;-webkit-overflow-scrolling:touch}
  #storyInner p{color:#e6e6ea;font-family:"Merriweather",serif;font-size:clamp(16px,3.8vw,18px);line-height:1.78;margin-bottom:14px;text-shadow:0 2px 8px rgba(0,0,0,.6)}
  /* breathing micro animation */
  @keyframes subtleFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-1.6px)}}
  #storyCard{animation:subtleFloat 8s ease-in-out infinite}

  /* story fog overlay to amplify blur/motion */
  #storyFog{position:absolute;inset:-18%;pointer-events:none;border-radius:28px;filter:blur(14px);opacity:1;mix-blend-mode:screen;background:
    radial-gradient(circle at 22% 30%, rgba(200,220,255,.04), transparent 36%),
    radial-gradient(circle at 78% 60%, rgba(120,150,200,.03), transparent 42%);transform:translateY(0);transition:transform .35s linear}

  /* spoiler: heavy blur veil with soft edges (no sharp edges), hides phrase */
  .spoiler{display:inline-block;position:relative;border-radius:30px;padding:10px 14px;margin-top:6px;cursor:pointer;overflow:visible}
  .spoiler .line{position:relative;z-index:1;color:transparent;user-select:none}
  .spoiler .beer-word{font-weight:700;color:transparent}
  /* the veil that creates the blur silhouette (backdrop-filter) */
  .spoiler .veil{
    position:absolute;inset:-6px;border-radius:40px;z-index:2;
    /* almost see-through but strongly blurred */
    background:linear-gradient(180deg, rgba(10,10,12,0.14), rgba(10,10,12,0.12));
    -webkit-backdrop-filter: blur(14px) saturate(1.05);backdrop-filter: blur(14px) saturate(1.05);
    box-shadow:0 8px 30px rgba(0,0,0,.46), inset 0 8px 24px rgba(255,255,255,.02);
    opacity:0.96;
    transition:opacity .6s ease, transform .6s cubic-bezier(.2,.8,.2,1);
    will-change:opacity,transform;
    pointer-events:none;
  }
  .spoiler .veil::before{
    content:"";position:absolute;inset:0;border-radius:inherit;
    background:radial-gradient(ellipse at center, rgba(255,255,255,.01), transparent 30%);
    filter:blur(2px);
  }
  .spoiler.open .veil{opacity:0;transform:translateY(-18px)}
  /* after reveal the text becomes visible and word emphasized */
  .spoiler.open .line{color:#fff;text-shadow:0 8px 24px rgba(0,0,0,.6)}
  .spoiler.open .beer-word{color:#ffd166;font-size:1.14em;text-shadow:0 8px 24px rgba(0,0,0,.6)}

  /* beer animation layer */
  #beerLayer{position:absolute;inset:0;pointer-events:none;z-index:40}
  #beerSprite{position:absolute;left:50%;top:-30%;width:min(34vw,160px);transform:translateX(-50%);display:none;will-change:transform}
  .splash,.foam{position:absolute;border-radius:50%;pointer-events:none;will-change:transform,opacity}
  .puddle{position:absolute;left:50%;bottom:12%;transform:translateX(-50%) scale(.2);width:20px;height:10px;border-radius:999px;opacity:0;background:radial-gradient(ellipse at 40% 30%, #fff4cc 0%, #ffd88a 30%, #c35e19 80%);filter:blur(1.4px);z-index:30}

  /* memes scene */
  #memesScene{position:absolute;inset:0;z-index:30;pointer-events:none;opacity:0;transition:opacity .45s ease}
  #memesScene.active{pointer-events:auto;opacity:1}
  .meme{position:absolute;border-radius:14px;padding:6px;background:linear-gradient(180deg, rgba(255,210,235,.12), rgba(255,180,220,.06));border:2px solid rgba(255,200,220,.14);box-shadow:0 22px 60px rgba(0,0,0,.45);overflow:hidden;cursor:pointer;backdrop-filter:blur(3px)}
  .meme img{width:100%;height:100%;object-fit:cover;display:block;user-select:none}

  /* confession */
  #confessionBox{width:min(92vw,920px);max-height:calc(100dvh - 2*var(--panel-pad));background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border-radius:18px;padding:28px;border:1px solid rgba(255,255,255,.08);box-shadow:0 32px 120px rgba(10,8,10,.6);text-align:center;color:#ffe4ec}
  #confessionText{font-family:'Marck Script', cursive; font-size:clamp(28px,6.2vw,40px); line-height:1.7}
  .conf-line{opacity:0;transform:translateY(10px);transition:opacity .45s ease, transform .45s ease}
  .word{display:inline-block;opacity:0;transform:translateY(6px);transition:all .35s cubic-bezier(.2,.9,.25,1)}
  .char{display:inline-block;animation:charShake 1.6s ease-in-out infinite}
  @keyframes charShake{
    0%{transform:translate(0,0) rotate(0)}
    25%{transform:translate(-1.8px,1px) rotate(-2deg)}
    50%{transform:translate(1.8px,-1px) rotate(2deg)}
    75%{transform:translate(-1px,-1px) rotate(-1deg)}
    100%{transform:translate(0,0) rotate(0)}
  }
  #heartBtn{font-size:56px;margin-top:12px;cursor:pointer;color:#ff4f7d;text-shadow:0 10px 28px rgba(255,79,125,.38);animation:heartPulse 1.6s ease-in-out infinite}
  @keyframes heartPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}

  /* video overlay */
  #videoOverlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .28s ease}
  #videoOverlay.active{opacity:1;pointer-events:auto}
  video{max-width:92vw;border-radius:12px;box-shadow:0 20px 70px rgba(0,0,0,.7)}

  /* responsive tweaks for iPhone 14 Plus */
  @media (min-width:420px) and (max-width:900px){
    #introCard{width:min(88vw,420px)}
    #confessionText{font-size:clamp(26px,6.8vw,36px)}
  }
</style>
</head>
<body>
<div id="app">
  <!-- background layers -->
  <div id="forestBg" class="layer" aria-hidden="true"></div>
  <div id="forestOverlay" class="layer" aria-hidden="true"></div>
  <video id="romanceVideo" class="layer" src="romance.mp4" muted playsinline loop preload="metadata" aria-hidden="true"></video>
  <div class="layer mistLayer" aria-hidden="true"></div>

  <!-- Intro (cat) -->
  <section id="intro">
    <div id="introCard" role="button" tabindex="0" aria-label="–ù–∞–∂–º–∏ –Ω–∞ –∫–æ—Ç–∏–∫–∞">
      <img id="catImg" src="cat.jpg" alt="–∫–æ—Ç –ë—É—Å—è ‚Äî –Ω–∞–∂–º–∏" />
      <div id="introHint">–Ω–∞–∂–º–∏ –Ω–∞ –∫–æ—Ç–∏–∫–∞ üêæ</div>
    </div>
  </section>

  <!-- Story scene -->
  <section id="storyScene" class="scene" aria-hidden="true">
    <div id="storyCard" role="dialog" aria-label="–†–∞—Å—Å–∫–∞–∑">
      <div id="storyFog" aria-hidden="true"></div>
      <div style="display:flex;justify-content:flex-end;padding:8px 12px 0 0;">
        <button id="storyClose" type="button" aria-label="–Ω–∞–∑–∞–¥">–Ω–∞–∑–∞–¥</button>
      </div>
      <div id="storyInner" tabindex="0" aria-label="–ò—Å—Ç–æ—Ä–∏—è">
        <p>–û–¥–Ω–∞–∂–¥—ã —è —Å–∏–¥–µ–ª –∫–∞–∫ –Ω–∏ –≤ —á—ë–º –Ω–µ –±—ã–≤–∞–ª–æ –¥–æ–º–∞, —Å–ª—É—à–∞–ª –≥—Ä—É—Å—Ç–Ω—É—é –º—É–∑—ã–∫—É, —Å–º–æ—Ç—Ä–µ–ª –≤ –æ–∫–Ω–æ, –¥—É–º–∞–ª –æ —Å–≤–æ—ë–º —Ç–ª–µ–Ω–Ω–æ–º –±—É–¥—É—â–µ–º, –∫–∞–∫ –≤–¥—Ä—É–≥‚Ä¶ –∑–≤–æ–Ω–æ–∫ –≤ –¥–≤–µ—Ä—å. –Ø –æ–ø–µ—à–∏–ª, –≤–µ–¥—å –±—ã–ª–æ 3 —á–∞—Å–∞ –Ω–æ—á–∏, –∏ —è –Ω–∏–∫–æ–≥–æ –Ω–µ –∂–¥–∞–ª. –í —Ç–æ—Ç –¥–µ–Ω—å –æ—â—É—â–µ–Ω–∏—è –ø–æ–∏—Å—Ç–∏–Ω–µ –±—ã–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ. –ù–∞ –¥–≤–æ—Ä–µ —Å—Ç–æ—è–ª–∞ –ª—ë–≥–∫–∞—è –¥—ã–º–∫–∞, –∞ –Ω–∞ –Ω–µ–±–µ –æ—Ç—á—ë—Ç–ª–∏–≤–æ –≤–∏–¥–Ω–µ–ª–∞—Å—å —è—Ä–∫–∞—è –ø–æ–ª–Ω–∞—è –ª—É–Ω–∞, –ø—Ä—è–º–æ –∫–∞–∫ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî –º—Ä–∞—á–Ω–∞—è –∏ –∑–∞–≥–∞–¥–æ—á–Ω–∞—è. –ü–æ–≥–æ–¥–∞ –∑–∞ –æ–∫–Ω–æ–º –ª–∏—à—å –¥–æ–±–∞–≤–ª—è–ª–∞ —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω–æ–º—É —Å–æ–±—ã—Ç–∏—é.</p>

        <p>¬´–£ —Å–æ—Å–µ–¥–∞, –Ω–∞–≤–µ—Ä–Ω–æ–µ, —á—Ç–æ-—Ç–æ —Å—Ç—Ä—è—Å–ª–æ—Å—å¬ª, ‚Äî –ø–æ—á–µ—Å–∞–≤ —Ä–µ–ø—É, –ø–æ–¥—É–º–∞–ª —è. –ù–æ —á—É–≤—Å—Ç–≤–æ —Ç—Ä–µ–≤–æ–≥–∏ –∑–∞—Ç–º–∏–ª–æ –º–æ–π —Ä–∞—Å—Å—É–¥–æ–∫, –∏ —è –º–µ–¥–ª–µ–Ω–Ω–æ, —Ç–∏—Ö–∏–º —à–∞–≥–æ–º –ø–æ–¥–æ—à—ë–ª –∫ –≤—Ö–æ–¥–Ω–æ–π –¥–≤–µ—Ä–∏. –°—Ç–æ—è–ª–∞ –ø–æ–ª–Ω–µ–π—à–∞—è —Ç–∏—à–∏–Ω–∞. –Ø –ø—ã—Ç–∞–ª—Å—è –ø—Ä–∏—Å–ª—É—à–∞—Ç—å—Å—è –∫ –∑–≤—É–∫–∞–º –ø–æ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É –¥–≤–µ—Ä–∏, –Ω–æ –∏—Ö –Ω–µ –±—ã–ª–æ. –Ø —Å—Ç–æ—è–ª —Ç–∞–∫ –≥–¥–µ-—Ç–æ –º–∏–Ω—É—Ç—É, –Ω–æ –ø–æ –æ—â—É—â–µ–Ω–∏—è–º –æ–Ω–∞ –¥–ª–∏–ª–∞—Å—å —Ü–µ–ª—É—é –≤–µ—á–Ω–æ—Å—Ç—å. –í –≥–æ–ª–æ–≤–µ –±—ã–ª–∞ –ª–∏—à—å —Ä–∞—Å—Ç–µ—Ä—è–Ω–Ω–æ—Å—Ç—å –∏ —Å–º—è—Ç–µ–Ω–∏–µ.</p>

        <p>–ö–∞–∫ –≤–¥—Ä—É–≥ —è —É—Å–ª—ã—à–∞–ª —Å—Ç—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø, –±—É–¥—Ç–æ –∫—Ç–æ-—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ —É–≤–µ—Ä–µ–Ω–Ω–æ –≤–æ–¥–∏–ª –Ω–æ–≥—Ç–µ–º –ø–æ —Å—Ç–∞–ª—å–Ω–æ–º—É –ª–∏—Å—Ç—É. –Ø —Å–∏–ª—å–Ω–æ –Ω–∞–ø—Ä—è–≥—Å—è, –≤—Å—ë —Ç–µ–ª–æ —Å –≥–æ–ª–æ–≤—ã –¥–æ –Ω–æ–≥ –ø—Ä–æ–±—Ä–∞–ª–æ –º—É—Ä–∞—à–∫–∞–º–∏, —è –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª —Ä–µ–∑–∫–∏–π —Å–∫–∞—á–æ–∫ –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞ ‚Äî —Ä–∞–∑—É–º —è–≤–Ω–æ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª, —á—Ç–æ —á—Ç–æ-—Ç–æ —Ç—É—Ç –Ω–µ —Ç–∞–∫. –Ø –Ω–∞–±—Ä–∞–ª—Å—è —Å–º–µ–ª–æ—Å—Ç–∏ –∏, —Å—Ü–µ–ø–∏–≤ –∑—É–±—ã, –≤—ã–¥–∞–≤–∏–ª –∏–∑ —Å–µ–±—è: ‚ÄûWer ist da?‚Äú –ù–æ, –∫–∞–∫ —è –∏ –æ–∂–∏–¥–∞–ª, –æ—Ç–≤–µ—Ç–∞ –Ω–µ –ø–æ—Å—Ç—É–ø–∏–ª–æ. –õ–∏—à—å —ç—Ç–æ—Ç –¥–æ –¥—Ä–æ–∂–∏ –ø—Ä–æ—Ç–∏–≤–Ω—ã–π –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –∑–≤—É–∫, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–Ω–∏–∫–∞–ª –≤ –∫–∞–∂–¥—É—é –∫–ª–µ—Ç–æ—á–∫—É –º–æ–∑–≥–∞‚Ä¶ –û—â—É—â–∞–ª–æ—Å—å, –±—É–¥—Ç–æ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä—è–º–æ —É –º–µ–Ω—è –≤ –≥–æ–ª–æ–≤–µ, –±—É–¥—Ç–æ –∫—Ç–æ-—Ç–æ —Å –∏–∑–¥—ë–≤–∫–æ–π –≤–æ–¥–∏—Ç –ø–æ –Ω–µ–º—É —Å–∫—Ä–∏–ø—É—á–µ–π –∂–µ–ª–µ–∑—è–∫–æ–π.</p>

        <p>–ò –≤–¥—Ä—É–≥ ‚Äî —Ç–∏—à–∏–Ω–∞. –°–Ω–æ–≤–∞. –Ø –ø–æ–Ω–∏–º–∞–ª, —á—Ç–æ –∫—Ç–æ –±—ã —Ç–æ –Ω–∏ –±—ã–ª –∑–∞ –¥–≤–µ—Ä—å—é, –≤–µ—Ä–æ—è—Ç–Ω–æ, —Ç–æ–∂–µ —É—Å–ª—ã—à–∞–ª, –∫–∞–∫ —è —Å—Ç–æ—é –∏ –º–æ–ª—á–∞ —Å–ª—É—à–∞—é, –≤–Ω–∏–º–∞—è —ç—Ç–æ—Ç –ø—Å–∏—Ö–æ–¥–µ–ª–∏—á–µ—Å–∫–∏–π —É–∂–∞—Å. –ì–¥–µ-—Ç–æ —Å–ø—É—Å—Ç—è —Å–µ–∫—É–Ω–¥ 20 —Ä–∞–∑–¥–∞–ª—Å—è –≥—Ä–æ–º–∫–∏–π –∂–µ–ª–µ–∑–Ω—ã–π –∑–≤—É–∫ ‚Äî –∑–≤—É–∫ –ø–∞–¥–µ–Ω–∏—è –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥ –º–æ–µ–π –≥—Ä—ë–±–∞–Ω–Ω–æ–π –¥–≤–µ—Ä—å—é. –Ø –Ω–∞–±—Ä–∞–ª—Å—è —Å–º–µ–ª–æ—Å—Ç–∏ –∏ –ø—Ä–∏—Å–ª–æ–Ω–∏–ª —É—Ö–æ –∫ –¥–≤–µ—Ä–∏, —á—Ç–æ–±—ã –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –∂–µ —É–ø–∞–ª–æ... –∏ —á—Ç–æ, —á—ë—Ä—Ç –≤–æ–∑—å–º–∏, —Ç—É—Ç –≤–æ–æ–±—â–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.</p>

        <p>–ö–∞–∫ –≤–¥—Ä—É–≥, –∫–∞–∫ –≥—Ä–æ–º —Å—Ä–µ–¥–∏ —è—Å–Ω–æ–≥–æ –¥–Ω—è, –∫–∞–∫ —Å–Ω–µ–≥ –≤ –∏—é–ª–µ, —è —É—Å–ª—ã—à–∞–ª –Ω–µ–∂–Ω—ã–π, –º–∏–ª—ã–π –∏ –¥–æ –±–æ–ª–∏ –∑–Ω–∞–∫–æ–º—ã–π –∂–µ–Ω—Å–∫–∏–π –≥–æ–ª–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–∏–∑–Ω—ë—Å:</p>

        <div class="spoiler" id="spoiler" role="button" tabindex="0" aria-pressed="false" aria-label="–û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω—á–ª–∞–π–Ω">
          <div class="veil" aria-hidden="true"></div>
          <!-- this line is hidden (color:transparent) until reveal; veil creates blurred silhouette -->
          <div class="line" aria-hidden="true">‚Äî –û–π, –∏–∑–≤–∏–Ω–∏, —É –º–µ–Ω—è <button class="beer-word" id="beerWord" type="button" aria-label="–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞–¥–µ–Ω–∏–µ –ø–∏–≤–∞">–ø–∏–≤–æ</button> —É–ø–∞–ª–æ.</div>
        </div>

      </div>
    </div>
  </section>

  <!-- beer / splash layer -->
  <div id="beerLayer" class="layer" aria-hidden="true">
    <img id="beerSprite" src="beer.png" alt="–±–∞–Ω–∫–∞ Desperados" />
    <div class="puddle" id="puddle"></div>
  </div>

  <!-- memes -->
  <section id="memesScene" class="layer" aria-hidden="true"></section>

  <!-- confession -->
  <section id="confessionScene" class="scene" aria-hidden="true">
    <div id="confessionBox">
      <div id="confessionText">
        –±—É—Å—è, –∫–æ—Ç–∏–∫, —è –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å —Ç–æ–±–æ–π –ª–∏—à—å –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥, –Ω–æ –≤–æ –º–Ω–µ —Ç–µ–ø–ª–∏—Ç—Å—è —á—É–≤—Å—Ç–≤–æ, –±—É–¥—Ç–æ —è –∑–Ω–∞–ª —Ç–µ–±—è –≤–æ –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –ø—Ä–æ—à–ª—ã—Ö –∂–∏–∑–Ω—è—Ö, –≤–µ–¥—å –±–æ–ª–µ–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç—á–∞ –Ω–∞ –∑–µ–º–ª–µ –µ—â–µ –Ω–µ –±—ã–ª–æ. –∏ –Ω–µ –±—É–¥–µ—Ç. —Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–∞—Ä–∏—à—å –º–Ω–µ —Ç—É —Å–∞–º—É—é —Ä–∞–¥–æ—Å—Ç—å –∏ —É–ª—ã–±–∫—É, –∫–æ—Ç–æ—Ä—ã—Ö —É –º–µ–Ω—è –æ—á–µ–Ω—å –¥–∞–≤–Ω–æ –Ω–µ –±—ã–ª–æ. –ø–æ–ª–≥–æ–¥–∞ –Ω–∞–∑–∞–¥ —è –∏ –Ω–µ –¥–º–∞–ª, —á—Ç–æ —Å–º–æ–≥—É –ø–æ–ª—é–±–∏—Ç—å –∫–æ–≥–æ-—Ç–æ —Ç–∞–∫ —Å–∏–ª—å–Ω–æ –∫–∞–∫ —Ç–µ–±—è. –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –∂–¥—É –Ω–∞—à–µ–π –≤—Å—Ç—Ä–µ—á–∏, —è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Ü–µ–ª—É—é —Ç–µ–±—è –ø–æ–¥ –ø—Ä–∏–ø–µ–≤ —ç—Ç–æ–π –ø–µ—Å–Ω–∏
      </div>
      <div id="heartBtn" role="button" tabindex="0" aria-label="–ù–∞–∂–∞—Ç—å —Å–µ—Ä–¥–µ—á–∫–æ">üíò</div>
      <div style="opacity:.85;margin-top:6px;font-size:13px">—Å–µ—Ä–¥–µ—á–∫–æ —Ç—ã–∫</div>
    </div>
  </section>

  <!-- video overlay -->
  <div id="videoOverlay" aria-hidden="true">
    <video id="finalVideo" src="video.mp4" controls playsinline preload="metadata"></video>
  </div>

  <!-- audio; keep in DOM so mobile will allow play inside user gesture -->
  <audio id="darkMusic" src="dark.mp3" preload="auto" loop></audio>
  <audio id="beerSfx" src="beer-sfx.mp3" preload="auto"></audio>
  <audio id="loveMusic" src="love.mp3" preload="auto" loop></audio>

</div>

<script>
/* --- Utilities & state --- */
const $ = (s) => document.querySelector(s);
const $$ = (s) => Array.from(document.querySelectorAll(s));

const introCard = $('#introCard');
const storyScene = $('#storyScene');
const storyInner = $('#storyInner');
const storyClose = $('#storyClose');
const spoiler = $('#spoiler');
const beerWord = $('#beerWord');
const beerSprite = $('#beerSprite');
const beerLayer = $('#beerLayer');
const puddle = $('#puddle');
const memesScene = $('#memesScene');
const confessionScene = $('#confessionScene');
const confessionText = $('#confessionText');
const heartBtn = $('#heartBtn');
const romanceVideo = $('#romanceVideo');

const darkMusic = $('#darkMusic');
const loveMusic = $('#loveMusic');
const beerSfx = $('#beerSfx');

let audioUnlocked = false;
let beerLaunched = false;
let memesRunning = false;
let memeLoopId = null;

/* Sync -- mobile VH fix */
function syncVH(){
  const vh = (window.visualViewport?.height || window.innerHeight) * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}
syncVH();
window.addEventListener('resize', syncVH, {passive:true});
window.addEventListener('orientationchange', syncVH, {passive:true});

/* Fade helper for audio */
function fadeAudio(audio, target, ms=900){
  const start = audio.volume || 0;
  const startT = performance.now();
  function step(now){
    const k = Math.min(1, (now - startT)/ms);
    audio.volume = start + (target - start) * k;
    if(k < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* Ensure audio can be played on iOS/Android: run small play/pause in user gesture */
function unlockAudio(){
  if(audioUnlocked) return;
  audioUnlocked = true;
  [darkMusic, loveMusic, beerSfx].forEach(a=>{
    try{ a.volume = 0; a.play().then(()=>a.pause()).catch(()=>{}); }catch(e){}
  });
}

/* Prepare story words: wrap every word in span so we can reveal word-by-word */
function prepareStoryWords(){
  const ps = Array.from(storyInner.querySelectorAll('p'));
  ps.forEach(p=>{
    const raw = p.textContent;
    const parts = raw.match(/\S+|\s+/g) || [raw];
    p.innerHTML = '';
    parts.forEach(part=>{
      if(/\s+/.test(part)){
        p.appendChild(document.createTextNode(part));
      } else {
        const w = document.createElement('span');
        w.className = 'story-word';
        w.style.opacity = 0;
        w.style.display = 'inline-block';
        w.style.transform = 'translateY(6px)';
        w.textContent = part;
        p.appendChild(w);
      }
    });
  });
}

/* Reveal story word-by-word (called immediately from the click handler to stay within user gesture timing for audio) */
function revealStoryWordsNow(delay=60){
  const words = $$('.story-word');
  words.forEach((w, i)=>{
    setTimeout(()=>{
      w.style.opacity = '1';
      w.style.transform = 'translateY(0)';
      w.style.transition = 'all .28s cubic-bezier(.2,.9,.25,1)';
    }, i * delay);
  });
}

/* Show story: run in the same click (user gesture) so darkMusic.play is allowed */
function showStory(evt){
  unlockAudio();
  // animate UI
  document.querySelector('#intro').classList.remove('active');
  document.querySelector('#intro').style.display = 'none';
  storyScene.classList.add('active');
  // immediately start dark music in the same gesture
  try{
    darkMusic.currentTime = 0;
    darkMusic.volume = 0;
    darkMusic.play().then(()=> fadeAudio(darkMusic, parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dark-volume') || 0.18), 1000 )).catch(()=>{});
  }catch(e){}
  // prepare & reveal story words
  prepareStoryWords();
  revealStoryWordsNow(58); // slower for atmosphere
}
introCard.addEventListener('click', showStory);
introCard.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showStory(); }});

storyClose.addEventListener('click', ()=>{
  storyScene.classList.remove('active');
  // return to intro state
  document.querySelector('#intro').style.display = '';
});

/* story scroll effect: move fog slightly with scroll */
storyInner.addEventListener('scroll', ()=>{
  const sc = storyInner.scrollTop / Math.max(1, storyInner.scrollHeight - storyInner.clientHeight);
  $('#storyFog').style.transform = `translateY(${sc * -14}px)`;
});

/* Spoiler reveal (blurred veil) */
function revealSpoiler(){
  if(spoiler.classList.contains('open')) return;
  spoiler.classList.add('open');
  // make the hidden line visible (color changes done by CSS .open)
  const line = spoiler.querySelector('.line');
  line.removeAttribute('aria-hidden');
}

/* Beer animation: toss from top to near-bottom; in the same user gesture we call beer.play? 
   We ensure beerSfx plays on impact (allowed because invoked from click that triggered this function). */
function beerFallAnimation(){
  if(beerLaunched) return;
  beerLaunched = true;
  // show sprite
  beerSprite.style.display = 'block';
  beerLayer.style.pointerEvents = 'none';
  const startX = window.innerWidth * (0.48 + (Math.random()*0.08 - 0.04));
  const startY = - (window.innerHeight * 0.6);
  const endY = window.innerHeight * 0.7;
  let t0 = performance.now();
  const duration = 900 + Math.random()*240; // fast but visible; adjust for iphone height
  function frame(now){
    const t = Math.min(1, (now - t0)/duration);
    const ease = 1 - Math.pow(1 - t, 3);
    const y = startY + (endY - startY) * ease;
    const rot = 360 * ease + Math.sin(ease * 6.28) * 18;
    beerSprite.style.left = `${startX}px`;
    beerSprite.style.top = `${y}px`;
    beerSprite.style.transform = `translateX(-50%) rotate(${rot}deg)`;
    if(t < 1) requestAnimationFrame(frame);
    else impact();
  }
  requestAnimationFrame(frame);

  function impact(){
    // small page shake
    document.body.classList.add('page-shake');
    setTimeout(()=>document.body.classList.remove('page-shake'), 520);

    // fade out darkMusic
    try{ fadeAudio(darkMusic, 0, 700); } catch(e){}
    // play sfx
    try{ beerSfx.currentTime = 0; beerSfx.volume = 0.9; beerSfx.play().catch(()=>{}); }catch(e){}

    // puddle reveal
    puddle.style.display = 'block';
    puddle.style.opacity = '1';
    puddle.animate([
      {transform:'translateX(-50%) scale(.18)', width:'18px', height:'8px', opacity:0},
      {transform:'translateX(-50%) scale(1)', width:'140px', height:'34px', opacity:1}
    ], {duration:520, easing:'cubic-bezier(.2,.85,.2,1)', fill:'forwards'});

    // after short delay -> start romance stage
    setTimeout(startRomanceStage, 700);
  }
}

/* Romance stage: show romanceVideo, start loveMusic, spawn memes */
function startRomanceStage(){
  // hide story
  storyScene.classList.remove('active');

  // show romance video (looped background)
  romanceVideo.style.opacity = 0.65;
  romanceVideo.play().catch(()=>{});
  // start love music (fade in)
  try{
    loveMusic.currentTime = 0; loveMusic.volume = 0; loveMusic.play().then(()=> fadeAudio(loveMusic, parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--love-volume') || 0.22), 1200)).catch(()=>{});
  }catch(e){}

  // spawn memes
  spawnMemes(18);
}

/* spawn many meme clones and animate with simple collision-ish repulsion */
function spawnMemes(count=18){
  memesScene.innerHTML = '';
  memesScene.classList.add('active');
  const memes = [];
  const w = window.innerWidth, h = window.innerHeight;
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'meme';
    const size = 100 + Math.random()*120;
    el.style.width = `${size}px`;
    el.style.height = `${size}px`;
    el.style.left = `${Math.random()*(w - size)}px`;
    el.style.top = `${Math.random()*(h - size)}px`;
    const img = document.createElement('img');
    img.src = 'meme.png';
    img.alt = '–º–µ–º';
    el.appendChild(img);
    memesScene.appendChild(el);
    const vx = (Math.random()*1.6+0.6) * (Math.random()>0.5?1:-1);
    const vy = (Math.random()*1.6+0.6) * (Math.random()>0.5?1:-1);
    memes.push({el, x:parseFloat(el.style.left), y:parseFloat(el.style.top), vx, vy, size});
    // clicking any meme reveals confession (only once)
    el.addEventListener('click', ()=>{ revealConfession(); }, {once:true});
    el.tabIndex = 0;
    el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); revealConfession(); }});
  }

  memesRunning = true;
  function loop(){
    for(let i=0;i<memes.length;i++){
      const a = memes[i];
      a.x += a.vx;
      a.y += a.vy;
      // bounds
      if(a.x < 0){ a.x = 0; a.vx *= -1; }
      if(a.y < 0){ a.y = 0; a.vy *= -1; }
      if(a.x + a.size > w){ a.x = w - a.size; a.vx *= -1; }
      if(a.y + a.size > h){ a.y = h - a.size; a.vy *= -1; }
      // simple repulsion
      for(let j=i+1;j<memes.length;j++){
        const b = memes[j];
        const dx = a.x - b.x, dy = a.y - b.y;
        const dist = Math.hypot(dx, dy) || 1;
        const minD = (a.size + b.size) * 0.32;
        if(dist < minD){
          const nx = dx/dist, ny = dy/dist;
          a.vx += nx * 0.12; a.vy += ny * 0.12;
          b.vx -= nx * 0.12; b.vy -= ny * 0.12;
        }
      }
      a.el.style.transform = `translate3d(${a.x}px, ${a.y}px, 0) rotate(${(a.vx+a.vy)*6}deg)`;
    }
    memeLoopId = requestAnimationFrame(loop);
  }
  loop();
}

/* Reveal confession: stop memes, fade them, and show confession word-by-word */
function revealConfession(){
  if(memeLoopId) cancelAnimationFrame(memeLoopId);
  memesScene.classList.remove('active');
  // fade out existing memes
  $$('.meme').forEach(m=>{ m.style.transition='opacity .45s ease, transform .6s ease'; m.style.opacity=0; m.style.transform='scale(.92)'; });
  setTimeout(()=>{
    memesScene.innerHTML=''; showConfession();
  }, 480);
}

/* Show confession: reveal by lines then by words (preserve exact user text) */
function showConfession(){
  confessionScene.classList.add('active');
  const raw = confessionText.textContent.trim();
  // preserve raw exactly (user requested no changes), split into lines by sentence breaks (we keep the original user string as-is)
  // we will split into sentences via regex to create lines but will not alter characters.
  const lines = raw.match(/[^.!?]+[.!?]?/g) || [raw];
  confessionText.innerHTML = '';
  const allWordNodes = [];
  lines.forEach((ln, idx)=>{
    const p = document.createElement('div');
    p.className = 'conf-line';
    // split with spaces preserved
    const parts = ln.match(/\S+|\s+/g) || [ln];
    parts.forEach(part=>{
      if(/\s+/.test(part)){
        p.appendChild(document.createTextNode(part));
      } else {
        const w = document.createElement('span');
        w.className = 'word';
        const chars = part.split('');
        chars.forEach(ch=>{
          const cspan = document.createElement('span');
          cspan.className = 'char';
          cspan.textContent = ch;
          w.appendChild(cspan);
        });
        p.appendChild(w);
        allWordNodes.push(w);
      }
    });
    confessionText.appendChild(p);
    // reveal whole line container slightly later
    setTimeout(()=>{ p.style.opacity = 1; p.style.transform='translateY(0)'; }, 220 + idx*420);
  });
  // reveal words sequentially
  allWordNodes.forEach((w, i)=>{
    setTimeout(()=>{ w.style.opacity = 1; w.style.transform='translateY(0)'; }, 350 + i * 90);
  });
}

/* Video overlay open */
$('#heartBtn').addEventListener('click', ()=>{ $('#videoOverlay').classList.add('active'); $('#finalVideo').play().catch(()=>{}); });
$('#heartBtn').addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); $('#videoOverlay').classList.add('active'); $('#finalVideo').play().catch(()=>{}); }});
$('#videoOverlay').addEventListener('click', (e)=>{ if(e.target === $('#videoOverlay')){ $('#videoOverlay').classList.remove('active'); try{ $('#finalVideo').pause(); }catch(e){} }});

/* Story spoiler click should reveal veil and start beer animation */
spoiler.addEventListener('click', (e)=>{
  // if clicking the small beer-word, handle separately
  if(e.target === beerWord || beerWord.contains(e.target)){
    // reveal then animate beer
    revealSpoiler();
    // small delay to let veil start to animate out
    setTimeout(()=> beerFallAnimation(), 150);
    return;
  }
  revealSpoiler();
  setTimeout(()=> beerFallAnimation(), 220);
});
spoiler.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); revealSpoiler(); setTimeout(()=> beerFallAnimation(), 200); }});

/* clicking beer word specifically (same effect) */
beerWord.addEventListener('click', (e)=>{ e.stopPropagation(); revealSpoiler(); beerFallAnimation(); });
beerWord.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); revealSpoiler(); beerFallAnimation(); }});

/* Make sure darkMusic is actually started in the same first click; if user tapped elsewhere to unlock audio earlier, it's okay */
window.addEventListener('touchstart', ()=>{ /* noop to help gesture unlock */ }, {passive:true});

/* Accessibility: keyboard close story */
storyClose.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); storyClose.click(); }});

/* Prevent accidental selection on iOS */
document.addEventListener('touchmove', ()=>{}, {passive:true});

/* Safety: if romanceVideo errors, keep fallback bg */
romanceVideo.addEventListener('error', ()=>{ romanceVideo.style.opacity = 0; });

/* End of script */
</script>
</body>
</html>
